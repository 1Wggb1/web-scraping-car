import requests
from bs4 import BeautifulSoup
from unidecode import unidecode


class Scraping:
    FAKE_AGENT_HEADER = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
        "Accept-Language": "en-US,en;q=0.5",
        "Accept-Encoding": "gzip, deflate",
        "Cookie": "__rtbh.lid=%7B%22eventType%22%3A%22lid%22%2C%22id%22%3A%22eqn4Lf9BzF7ofZaL83DI%22%7D; _gcl_au=1.1.1101457894.1719700240; _fbp=fb.2.1719700244280.376154044209668997; _tgpc=69e6057e-f257-5a31-9f61-3f2caa296026; _pxvid=39efd18b-3667-11ef-b967-8461b26e0fbc; __rtbh.uid=%7B%22eventType%22%3A%22uid%22%2C%22id%22%3A%22unknown%22%7D; FCNEC=%5B%5B%22AKsRol9YASR9ZOJpY4JQ8q84wtquXKmH8VKLnyjl-9ZBM2RUW33qKI-18lW-9GQwN36t-PMWiyGKIevd8T6-n5HzFfGLq6VN2P4fYU3mXxlHzViofQ6hNGbYHu7ajfyqiVCobj1sSuJKZF7skSo3-ERkSJcMdW6OsA%3D%3D%22%5D%5D; __spdt=fbe1faf0915c45a59ae9c66dd41477f9; _tt_enable_cookie=1; _ttp=ClXyYpkcPZQLEAiyS2dBHWStbSF; at_check=true; AMCVS_3ADD33055666F1A47F000101%40AdobeOrg=1; AMCV_3ADD33055666F1A47F000101%40AdobeOrg=179643557%7CMCIDTS%7C19911%7CMCMID%7C70786698168889455273463818733269728654%7CMCAAMLH-1720983768%7C4%7CMCAAMB-1720983768%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1720386168s%7CNONE%7CvVersion%7C5.5.0; WebMotorsVisitor=1; s_plt=NaN; s_pltp=undefined; WebMotorsDataFormLeads=%7B%22dataForm%22%3A%7B%22uniqueId%22%3A52562847%2C%22listingType%22%3A%22U%22%2C%22vehicleType%22%3A%22car%22%2C%22idGuid%22%3A%222cb61352-a62f-45ed-994c-017efc296a45%22%2C%22make%22%3A%22HYUNDAI%22%2C%22makeId%22%3A17%2C%22model%22%3A%22I30%22%2C%22modelId%22%3A3034%2C%22version%22%3A%222.0%20MPFI%20GLS%2016V%20GASOLINA%204P%20AUTOM%C3%81TICO%22%2C%22versionId%22%3A343389%2C%22yearModel%22%3A2012%2C%22yearFabrication%22%3A2011%2C%22price%22%3A36900%2C%22sellerId%22%3A26758950%2C%22sellerType%22%3A%22PF%22%2C%22city%22%3A%22S%C3%A3o%20Paulo%22%2C%22sellerName%22%3A%22BIANCA%22%2C%22hyundaiGroup%22%3Afalse%7D%7D; pxcts=86c0bf8a-3c93-11ef-bec4-238e4f5b099b; s_cc=true; __gads=ID=157ed3800e926958:T=1719700236:RT=1720378984:S=ALNI_MaoqVHuY8TJp7qY5sbX_qmBxHWiuw; __gpi=UID=00000db1db2b18de:T=1719700236:RT=1720378984:S=ALNI_MY4SQxgSdtS0xHGHiINxds9kn5o_A; __eoi=ID=6ad9f53b11c7b2d7:T=1719700236:RT=1720378984:S=AA-AfjbXibQBWNpPa8t0HFqBzhXx; WMLastFilterSearch=%7B%22car%22%3A%22carros%2Fsp-sao-paulo%2Fhonda%2Ffit%3Festadocidade%3DS%25C3%25A3o%2520Paulo%2520-%2520S%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26localizacao%3D-23.5505199%2C-46.6333094x50km%26kmate%3D120000%26marca1%3DHONDA%26modelo1%3DFIT%26precoate%3D45000%26lkid%3D1040%22%2C%22bike%22%3A%22motos%2Festoque%22%2C%22estadocidade%22%3A%22S%C3%A3o%20Paulo%20-%20S%C3%A3o%20Paulo%22%2C%22lastType%22%3A%22car%22%2C%22cookie%22%3A%22v3%22%2C%22ano%22%3A%7B%7D%2C%22preco%22%3A%7B%22precoate%22%3A%2245000%22%7D%2C%22marca%22%3A%22HONDA%22%2C%22modelo%22%3A%22FIT%22%7D; gpv_v39=%2Fwebmotors%2Fcomprar%2Fresultado; _tguatd=eyJzYyI6IihkaXJlY3QpIn0=; _tgidts=eyJzaCI6ImQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlIiwiY2kiOiJmNDVhMGNhZS1kMTIxLTUzZWEtYjQ0MS1hNTEzYmY5OGZlMjAiLCJzaSI6IjdlNDc3NjZjLTViMDQtNTI4My1iZjMyLWI1NzQ4NjdjZjFmZiJ9; s_sq=%5B%5BB%5D%5D; WebMotorsLastSearches=%5B%7B%22route%22%3A%22carros%2Fsp-sao-paulo%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Festadocidade%3DS%25C3%25A3o%2520Paulo%2520-%2520S%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26localizacao%3D-23.5505199%2C-46.6333094x50km%26kmate%3D120000%26marca1%3DHONDA%26modelo1%3DFIT%26precoate%3D45000%26lkid%3D1040%22%7D%2C%7B%22route%22%3A%22carros%2Fsp%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Festadocidade%3DS%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26kmate%3D120000%26marca1%3DHONDA%26modelo1%3DFIT%26precoate%3D45000%22%7D%2C%7B%22route%22%3A%22carros%2Festoque%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Ftipoveiculo%3Dcarros%26kmate%3D120000%26marca1%3DHONDA%26modelo1%3DFIT%26precoate%3D45000%22%7D%2C%7B%22route%22%3A%22carros%2Fsp-sao-paulo%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Festadocidade%3DS%25C3%25A3o%2520Paulo%2520-%2520S%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26localizacao%3D-23.5505199%2C-46.6333094x100km%26kmate%3D120000%26marca1%3DHONDA%26modelo1%3DFIT%26precoate%3D45000%22%7D%2C%7B%22route%22%3A%22carros%2Fsp%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Festadocidade%3DS%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26kmate%3D130000%26marca1%3DHONDA%26modelo1%3DFIT%26precoate%3D45000%22%7D%2C%7B%22route%22%3A%22carros%2Fsp%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Festadocidade%3DS%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26kmate%3D1%26marca1%3DHONDA%26modelo1%3DFIT%26precoate%3D45000%22%7D%2C%7B%22route%22%3A%22carros%2Fsp%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Festadocidade%3DS%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26kmate%3D10%26marca1%3DHONDA%26modelo1%3DFIT%26precoate%3D45000%22%7D%2C%7B%22route%22%3A%22carros%2Fsp%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Festadocidade%3DS%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26marca1%3DHONDA%26modelo1%3Dfit%26precoate%3D45000%22%7D%2C%7B%22route%22%3A%22carros%2Fsp%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Festadocidade%3DS%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26marca1%3DHONDA%26modelo1%3Dfit%26precoate%3D45%22%7D%2C%7B%22route%22%3A%22carros%2Fsp%2Fhonda%2Ffit%22%2C%22query%22%3A%22%3Festadocidade%3DS%25C3%25A3o%2520Paulo%26tipoveiculo%3Dcarros%26marca1%3DHONDA%26modelo1%3Dfit%26precoate%3D4%22%7D%5D; WebMotorsSearchDataLayer=%7B%22search%22%3A%7B%22location%22%3A%7B%22city%22%3A%22S%C3%A3o%20Paulo%20SP%22%2C%22state%22%3A%22SP%22%7D%2C%22ordination%22%3A%7B%22name%22%3A%22Mais%20relevantes%22%2C%22id%22%3A1%7D%2C%22pageNumber%22%3A1%2C%22totalResults%22%3A21%2C%22vehicle%22%3A%7B%22type%22%3A%7B%22id%22%3A1%2C%22name%22%3A%22carro%22%7D%7D%2C%22cardExhibition%22%3A%7B%22id%22%3A%221%22%2C%22name%22%3A%22Cards%20Grid%22%7D%2C%22eventType%22%3A%22buscaRealizada%22%7D%7D; cto_bundle=sUA4wl9BMTQlMkZDT2g1eVU4dDN5TVV0MVk0cjhYQVRLM254REpIMlIlMkJJUW9tWUxTT0tFbzNQRiUyQnRjJTJGdjNheXo0bzhiOEJmRHdzeWFCNUUxVHZMWWxZdVMzOVVMRXI3M1lidk0lMkJUS1V2RVpoUSUyRnR5OHhqN25GejhWVWVSNlNDaWh5amxrSGdwZzUycDd0ODZiVFh0ZDgyV0g0aGFFR2hHVHVwcTF3RkVIOE92JTJGdDdtU2lEdUYlMkY4UHRPUmlVc2FvWVM3JTJCN1hPVlZoRlZzNHZBM1lPVlJXZSUyQlNXUGZNQ1JCY2NWbDBFbzBmMXAlMkZlRGlqVEgyd1pKU3gyVnZZMnR4RUNQRWs2RnZlZlVrR0Uwc3ZYM1hpOVV5Z1ZmWlU5VGpZJTJCSzNZRXVySkJMNnNUciUyRnVnMUUxU3c5V2xlc200cDVOWFNEQVZk; _tglksd=eyJzIjoiN2U0Nzc2NmMtNWIwNC01MjgzLWJmMzItYjU3NDg2N2NmMWZmIiwic3QiOjE3MjAzNzkwMDY3NjQsInNvZCI6IihkaXJlY3QpIiwic29kdCI6MTcyMDM3OTAwNjc2NCwic29kcyI6ImMiLCJzb2RzdCI6MTcyMDM3OTAyNjQyMX0=; mbox=PC#99e0fe7f45cf4c0ba76f201442fdb8fe.34_0#1783623827|session#85dca6a87f41495ea2e97c219062cd86#1720380889; _px3=63cde2d2ac7462fc945ff88e5cdb6d1e86c4f93c992642c0a23f5eb37c901468:1d0002YMiZXqEIdAv7/LNb71t2QQcIT1e4+D3y0eNByHgW6i/2m67HBb7w/bmdt1UzBmxrJb1u0IBPCl5F2XIw==:1000:d/Hd1P7hGHTUeJRiH2pvzazIJlY20w+TWTthmIg92DACEdaR63I967tzUjxhUftQ5jk5hcDJZ+IRheVsNuR3ugfg4fLrGT/2fG0Z52D9KXm97C9FlwkCnWHq9usHyCVwQlZnAAaV0DjiGYRxNsXhwQJAzmNVaZpCuaqjGixpRLyykMM03b0P5CdCgtddRkPyGdbTb0nupxsJADuTxQ7xfVzjX6nRPxPUwn/wBLg1hpo=; _tgsid=eyJscGQiOiJ7XCJscHVcIjpcImh0dHBzOi8vd3d3LndlYm1vdG9ycy5jb20uYnIlMkZjYXJyb3MlMkZzcC1zYW8tcGF1bG8lMkZob25kYSUyRmZpdFwiLFwibHB0XCI6XCJIb25kYSUyMEZpdCUzQSUyMENhcnJvcyUyMHVzYWRvcyUyQyUyMHNlbWlub3ZvcyUyMGUlMjBub3ZvcyUyMGVtJTIwUyVDMyVBM28lMjBQYXVsbyUyRlNQJTIwJTdDJTIwV2VibW90b3JzJTIwJTdDJTIwV2VibW90b3JzXCIsXCJscHJcIjpcIlwifSIsInBzIjoiYzk3MmFlNDgtNDUyYy00YjI2LTk3NzEtZGI3NmM2ODg2OWRjIiwicHZjIjoiMiIsInNjIjoiN2U0Nzc2NmMtNWIwNC01MjgzLWJmMzItYjU3NDg2N2NmMWZmOi0xIiwiZWMiOiI1IiwicHYiOiIxIiwidGltIjoiN2U0Nzc2NmMtNWIwNC01MjgzLWJmMzItYjU3NDg2N2NmMWZmOjE3MjAzNzkwMTA1MzM6LTEifQ==; _pxde=c9e1c01574694123f8c13d28935fba796cba4b72b8da8e57998864cfbaddcf2c:eyJ0aW1lc3RhbXAiOjE3MjAzNzkwNDgzNDF9; _dd_s=rum=0&expire=1720380005083",
        "Upgrade-Insecure-Requests": "1"}

    def search(self, site_url):
        scraping_content = requests.get(site_url, headers=Scraping.FAKE_AGENT_HEADER).content
        return scraping_content

    def filter(self, scraping_result, html_filter_element, html_filter):
        soup_html_result = BeautifulSoup(scraping_result, 'html.parser')
        return soup_html_result.find(html_filter_element, html_filter)

    def create_result(self, ad_url: str, result: str) -> dict:
        return {
            "ad_url": unidecode(ad_url),
            "car": result
        }
